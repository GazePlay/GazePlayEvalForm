<div class="container-fluid main">
  <div class="card">
    <div class="card-header text-center bg-secondary">
      <h1>Images & Sons</h1>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <div *ngFor="let item of [].constructor(this.nbItem); let indexItem = index">
          <div class="container-fluid second">
            <div class="card">
              <div class="card-header text-center bg-secondary">
                <h2>Item {{indexItem + 1}}</h2>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <div class="row">
                    <div class="col-4">
                      <label class="form-label">Nombre de lignes</label>
                      <input (change)="setRows($event, indexItem)"
                             [value]="this.rows[indexItem]" class="form-control" min="0" step="1"
                             type="number">
                    </div>
                    <div class="col-4">
                      <label class="form-label">Nombre de colonnes</label>
                      <input (change)="setCols($event, indexItem)"
                             [value]="this.cols[indexItem]" class="form-control" min="0" step="1"
                             type="number">
                    </div>
                    <div class="col-4">
                      <label class="form-label">Nombre d'image à regarder</label>
                      <input (change)="setNbImgToSee($event, indexItem)"
                             [value]="this.nbImgToSee[indexItem]" class="form-control" min="0" step="1"
                             type="number">
                    </div>
                  </div>
                  <br>
                  <div class="row">
                    <label class="form-label">Son</label>
                    <div class="col-4 addSong">
                      <button type="button" class="btn imgAndSound" (click)="openChooseSoundDialog(indexItem)">Choisir le son</button>
                    </div>
                    <div class="col-4 audioElem">
                      <div class="closeButton">
                        <button type="button" class="btn-close" aria-label="Close"></button>
                      </div>
                      <div class="audioPos">
                        <audio [src]="getSrcAudioFile(indexItem)" controls></audio>
                      </div>
                    </div>
                    <div class="col-4">
                      <label class="form-label">Temps de fixation</label>
                      <div class="input-group">
                        <input (change)="setFixationLength($event, indexItem)" [value]="this.fixationLength[indexItem]" class="form-control" min="0"
                               step="0.1" type="number">
                        <div class="input-group-append">
                          <span class="input-group-text">secondes</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                  <mat-grid-list [cols]="this.cols[indexItem]" [rowHeight]="this.rowHeight[indexItem]">
                    <mat-grid-tile
                      *ngFor="let grid of this.imgToDisplay[indexItem]; let indexGrid = index"
                      [colspan]="1"
                      [rowspan]="1">
                      <div class="tileSize">
                        <div class="row">
                          <div class="col-6 imgTile">
                            <div class="closeButton">
                              <button (click)="resetImg(indexItem, indexGrid)" type="button" class="btn-close" aria-label="Close"></button>
                            </div>
                            <img class="imgSize" [src]="this.imgToDisplay[indexItem][indexGrid][0]" alt="Pas d'image">
                          </div>
                          <div class="col-6 addImg">
                            <button class="btn imgAndSound" type="button" (click)="inputImport.click()">
                              <input hidden type="file" (change)="addImg($event, indexItem, indexGrid)" accept=".jpg, .jpeg, .png" #inputImport>
                              Importer une image
                            </button>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-4 leftInput">
                            <label class="form-label">Nombre de score associé</label>
                            <input class="form-control" type="number" min="0" step="1" [value]="this.imgToDisplay[indexItem][indexGrid][1]" (change)="setNbScore($event, indexItem, indexGrid)">
                          </div>
                          <div *ngIf="this.imgToDisplay[indexItem][indexGrid][1]>0" class="col-4 rigthInput">
                            <label [for]="'InfoType' + indexGrid" class="form-label">Type</label>
                            <select *ngFor="let choiceScore of [].constructor(this.imgToDisplay[indexItem][indexGrid][1]); let indexChoice = index" (change)="setChoiceOption($event, indexItem, indexGrid, indexChoice)" [id]="'InfoType' + indexGrid" aria-label="Default select example"
                                    class="form-select">
                              <option value="">Choisir le score</option>
                              <option *ngFor="let score of this.listScores; let indexScore = index" [value]="this.listScores[indexScore][0]" [selected]="choiceIsSelected(this.listScores[indexScore][0], indexItem, indexGrid, indexChoice)">{{this.listScores[indexScore][0]}}</option>
                            </select>
                          </div>
                          <div *ngIf="this.imgToDisplay[indexItem][indexGrid][1]>0" class="col-4 rigthInput">
                            <label class="form-label">Valeur du score</label>
                            <input *ngFor="let valueScore of [].constructor(this.imgToDisplay[indexItem][indexGrid][1]); let indexValueScore = index" (change)="setValueScore($event, indexItem, indexGrid, indexValueScore)" [value]="this.imgToDisplay[indexItem][indexGrid][3 + (indexValueScore * 2)]" class="form-control" type="number" step="1">
                          </div>
                        </div>
                      </div>
                    </mat-grid-tile>
                  </mat-grid-list>
                <br>
                <div class="removeButton">
                  <button (click)="removeOneItem(indexItem)" class="btn btn-danger" type="button">-</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-3 text-center">
          <button (click)="addOneMoreItem()" class="btn btn-secondary" type="button">+</button>
        </div>
      </div>
    </div>
    <div class="mb-3 text-center">
      <button (click)="previous()" class="btn btn-secondary" type="button">Précédent</button>
      <button (click)="home()" class="btn btn-secondary" type="button">Accueil</button>
      <button (click)="next()" class="btn btn-secondary" type="button">Suivant</button>
    </div>
  </div>
</div>
